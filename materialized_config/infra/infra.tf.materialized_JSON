{
  "protoFile": "terraform/terraform.proto",
  "value": {
    "@type": "type.googleapis.com/terraform.Terraform",
    "resource": {
      "cloudflare_record": {
        "server-3-ams3-c01": {
          "name": "${random_pet.server-3-ams3-c01.id}.node.ams3c01",
          "type": "A",
          "value": "${digitalocean_droplet.server-3-ams3-c01.ipv4_address}",
          "zone_id": "f05cf5af25ffab8e186f43cfea099628"
        },
        "server-4-ams3-c01": {
          "name": "${random_pet.server-4-ams3-c01.id}.node.ams3c01",
          "type": "A",
          "value": "${digitalocean_droplet.server-4-ams3-c01.ipv4_address}",
          "zone_id": "f05cf5af25ffab8e186f43cfea099628"
        },
        "server-5-ams3-c01": {
          "name": "${random_pet.server-5-ams3-c01.id}.node.ams3c01",
          "type": "A",
          "value": "${digitalocean_droplet.server-5-ams3-c01.ipv4_address}",
          "zone_id": "f05cf5af25ffab8e186f43cfea099628"
        }
      },
      "digitalocean_droplet": {
        "server-3-ams3-c01": {
          "image": "ubuntu-18-04-x64",
          "name": "${random_pet.server-3-ams3-c01.id}",
          "private_networking": true,
          "region": "ams3",
          "size": "s-1vcpu-1gb",
          "ssh_keys": [
            "${digitalocean_ssh_key.smintz-0.id}"
          ],
          "tags": [
            "server",
            "c01"
          ],
          "user_data": "#!/bin/bash\napt-get update\napt-get install -y unzip curl jq dnsutils\nuseradd --system --home /etc/consul.d --shell /bin/false consul\nmkdir -p /etc/consul.d\nchown root:root /etc/consul.d\nchmod 0755 /etc/consul.d\nmkdir -p /opt/consul\nchown consul:consul /opt/consul\nchmod 0755 /opt/consul\ncurl -L https://releases.hashicorp.com/consul/1.7.1/consul_1.7.1_linux_amd64.zip -o /tmp/consul-1.7.1.zip\nchown root:root /tmp/consul-1.7.1.zip\nchmod 0644 /tmp/consul-1.7.1.zip\nunzip -x /tmp/consul-1.7.1.zip -d /usr/local/bin\nrm /tmp/consul-1.7.1.zip\nconsul -autocomplete-install\ncomplete -C /usr/local/bin/consul consul\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/systemd/network/consul0.netdev\nIyBDcmVhdGVzIGEgImR1bW15IiBuZXR3b3JrIGludGVyZmFjZQojIHdlJ2xsIGNvbmZpZ3VyZSB0aGlzIGludGVyZmFjZSB3aXRoIGEgbGluay1sb2NhbCBhZGRyZXNzCiMgU2VlOiBodHRwczovL3d3dy5mcmVlZGVza3RvcC5vcmcvc29mdHdhcmUvc3lzdGVtZC9tYW4vc3lzdGVtZC5uZXRkZXYuaHRtbAojIwoKW05ldERldl0KTmFtZT1jb25zdWwwCktpbmQ9ZHVtbXkK\nFILE_CONTENT\nchown root:root /etc/systemd/network/consul0.netdev\nchmod 0644 /etc/systemd/network/consul0.netdev\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/systemd/network/consul0.network\nIyBXZSAiZmluZCIgdGhlIGR1bW15MCBpbnRlcmZhY2Ugd2UgY3JlYXRlZCBhbmQgY29uZmlndXJlIGl0IHdpdGggYSBsaW5rLWxvY2FsIGFkZHJlc3MKIyBTZWU6IGh0dHBzOi8vd3d3LmZyZWVkZXNrdG9wLm9yZy9zb2Z0d2FyZS9zeXN0ZW1kL21hbi9zeXN0ZW1kLm5ldHdvcmsuaHRtbAojIwpbTWF0Y2hdCk5hbWU9Y29uc3VsMAoKW05ldHdvcmtdCkFkZHJlc3M9MTY5LjI1NC4xLjEvMzIKCiMgV2Ugd2FudCB0aGVzZSBkb21haW5zCkRvbWFpbnM9IH5wY28ubmYuCgojIFRvIGdvIHRvIHRoZSBjb25zdWwgRE5TIHNlcnZlciB3ZSdsbCBiaW5kIHRvIHRoaXMgYWRkcmVzcwpETlM9MTY5LjI1NC4xLjEK\nFILE_CONTENT\nchown root:root /etc/systemd/network/consul0.network\nchmod 0644 /etc/systemd/network/consul0.network\nsystemctl restart systemd-networkd\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/consul.d/config.hcl\ndWkgPSB0cnVlCmJpbmRfYWRkciA9ICIwLjAuMC4wIgphZHZlcnRpc2VfYWRkciA9ICJ7e0dldFB1YmxpY0lQfX0iCmRhdGFjZW50ZXIgPSAiYW1zM2MwMSIKZGF0YV9kaXIgPSAiL29wdC9jb25zdWwiCmRvbWFpbiA9ICJwY28ubmYi\nFILE_CONTENT\nchown consul:consul /etc/consul.d/config.hcl\nchmod 0640 /etc/consul.d/config.hcl\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/consul.d/server.hcl\nc2VydmVyID0gdHJ1ZQpib290c3RyYXBfZXhwZWN0ID0gMw==\nFILE_CONTENT\nchown consul:consul /etc/consul.d/server.hcl\nchmod 0640 /etc/consul.d/server.hcl\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /usr/local/share/ca-certificates/protoconf.crt\nJHt0bHNfc2VsZl9zaWduZWRfY2VydC5yb290LmNlcnRfcGVtfQ==\nFILE_CONTENT\nchown root:root /usr/local/share/ca-certificates/protoconf.crt\nchmod 0644 /usr/local/share/ca-certificates/protoconf.crt\nupdate-ca-certificates\nmkdir -p /etc/consul.d/tls\nchown root:root /etc/consul.d/tls\nchmod 0755 /etc/consul.d/tls\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/consul.d/tls/key.pem\nJHt0bHNfcHJpdmF0ZV9rZXkuc2VydmVyLTMtYW1zMy1jMDEtY29uc3VsLnByaXZhdGVfa2V5X3BlbX0=\nFILE_CONTENT\nchown consul:consul /etc/consul.d/tls/key.pem\nchmod 600 /etc/consul.d/tls/key.pem\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/consul.d/tls/cert.pem\nJHt0bHNfbG9jYWxseV9zaWduZWRfY2VydC5zZXJ2ZXItMy1hbXMzLWMwMS1jb25zdWwuY2VydF9wZW19\nFILE_CONTENT\nchown consul:consul /etc/consul.d/tls/cert.pem\nchmod 0644 /etc/consul.d/tls/cert.pem\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/consul.d/tls.hcl\na2V5X2ZpbGUgPSAiL2V0Yy9jb25zdWwuZC90bHMva2V5LnBlbSIKY2VydF9maWxlID0gIi9ldGMvY29uc3VsLmQvdGxzL2NlcnQucGVtIgpjYV9maWxlID0gIi91c3IvbG9jYWwvc2hhcmUvY2EtY2VydGlmaWNhdGVzL3Byb3RvY29uZi5jcnQiCmFkZHJlc3NlcyB7CiAgICBodHRwcyA9ICIwLjAuMC4wIgogICAgZG5zID0gIjE2OS4yNTQuMS4xIgp9CnBvcnRzIHsKICAgIGh0dHBzID0gODUwMQogICAgZG5zID0gNTMKfQpyZWN1cnNvcnMgPSBbIjEyNy4wLjAuNTMiXQo=\nFILE_CONTENT\nchown root:root /etc/consul.d/tls.hcl\nchmod 0644 /etc/consul.d/tls.hcl\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/consul.d/join_lan.hcl\ncmV0cnlfam9pbiA9IFsicHJvdmlkZXI9ZGlnaXRhbG9jZWFuIGFwaV90b2tlbj0ke3Zhci5kaWdpdGFsb2NlYW5fdG9rZW59IHJlZ2lvbj1hbXMzIHRhZ19uYW1lPXNlcnZlciJd\nFILE_CONTENT\nchown consul:consul /etc/consul.d/join_lan.hcl\nchmod 0640 /etc/consul.d/join_lan.hcl\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/systemd/system/consul.service\nW1VuaXRdCkFmdGVyPW5ldHdvcmstb25saW5lLnRhcmdldApEZXNjcmlwdGlvbj1IYXNoaUNvcnAgQ29uc3VsIC0gQSBzZXJ2aWNlIG1lc2ggc29sdXRpb24KRG9jdW1lbnRhdGlvbj1odHRwczovL3d3dy5jb25zdWwuaW8vClJlcXVpcmVzPW5ldHdvcmstb25saW5lLnRhcmdldApbU2VydmljZV0KQW1iaWVudENhcGFiaWxpdGllcz1DQVBfTkVUX0JJTkRfU0VSVklDRQpFeGVjUmVsb2FkPS91c3IvbG9jYWwvYmluL2NvbnN1bCByZWxvYWQKRXhlY1N0YXJ0PS91c3IvbG9jYWwvYmluL2NvbnN1bCBhZ2VudCAtY29uZmlnLWRpcj0vZXRjL2NvbnN1bC5kLwpHcm91cD1jb25zdWwKS2lsbE1vZGU9cHJvY2VzcwpMaW1pdE5PRklMRT02NTUzNgpSZXN0YXJ0PW9uLWZhaWx1cmUKVHlwZT1ub3RpZnkKVXNlcj1jb25zdWwKW0luc3RhbGxdCldhbnRlZEJ5PW11bHRpLXVzZXIudGFyZ2V0\nFILE_CONTENT\nchown root:root /etc/systemd/system/consul.service\nchmod 0644 /etc/systemd/system/consul.service\nsystemctl start consul\nsystemctl enable consul\ncurl -L https://releases.hashicorp.com/vault/1.3.2/vault_1.3.2_linux_amd64.zip -o /tmp/vault-1.3.2.zip\nchown root:root /tmp/vault-1.3.2.zip\nchmod 0644 /tmp/vault-1.3.2.zip\nunzip -x /tmp/vault-1.3.2.zip -d /usr/local/bin\nrm /tmp/vault-1.3.2.zip\nvault -autocomplete-install\nsetcap cap_ipc_lock=+ep /usr/local/bin/vault\nuseradd --system --home /etc/vault.d --shell /bin/false vault\nmkdir -p /etc/vault.d\nchown vault:vault /etc/vault.d\nchmod 0755 /etc/vault.d\nmkdir -p /etc/vault.d/tls\nchown root:root /etc/vault.d/tls\nchmod 0755 /etc/vault.d/tls\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/vault.d/tls/key.pem\nJHt0bHNfcHJpdmF0ZV9rZXkuc2VydmVyLTMtYW1zMy1jMDEtdmF1bHQucHJpdmF0ZV9rZXlfcGVtfQ==\nFILE_CONTENT\nchown vault:vault /etc/vault.d/tls/key.pem\nchmod 600 /etc/vault.d/tls/key.pem\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/vault.d/tls/cert.pem\nJHt0bHNfbG9jYWxseV9zaWduZWRfY2VydC5zZXJ2ZXItMy1hbXMzLWMwMS12YXVsdC5jZXJ0X3BlbX0=\nFILE_CONTENT\nchown vault:vault /etc/vault.d/tls/cert.pem\nchmod 0644 /etc/vault.d/tls/cert.pem\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/vault.d/vault.hcl\ndWkgPSB0cnVlCnN0b3JhZ2UgImNvbnN1bCIgewogICAgcGF0aCA9ICJ2YXVsdC8iCn0KbGlzdGVuZXIgInRjcCIgewogIGFkZHJlc3MgICAgICAgPSAiMC4wLjAuMDo4MjAwIgogIHRsc19jZXJ0X2ZpbGUgPSAiL2V0Yy92YXVsdC5kL3Rscy9jZXJ0LnBlbSIKICB0bHNfa2V5X2ZpbGUgID0gIi9ldGMvdmF1bHQuZC90bHMva2V5LnBlbSIKfQo=\nFILE_CONTENT\nchown root:root /etc/vault.d/vault.hcl\nchmod 0644 /etc/vault.d/vault.hcl\nmkdir -p /etc/vault.d/scripts\nchown vault:vault /etc/vault.d/scripts\nchmod 0755 /etc/vault.d/scripts\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/vault.d/scripts/post_start.sh\nIyEvYmluL2Jhc2gKCiMgVGhpcyBzY3JpcHQgd2lsbCBydW4gYWZ0ZXIgZXZlcnkgdGltZSB2YXVsdCBpcyBzdGFydGVkLiBJdCB3aWxsIHRyeSB0bzoKIyAxLiBWYWxpZGF0ZSBpZiB2YXVsdCBpcyBpbml0aWFsaXplZAojIDEuMS4gaW5pdGlhbGl6ZSB2YXVsdCBhbmQgc2F2ZSB0aGUgdW5zZWFsIGtleXMgaW4gL3Jvb3QvdmF1bHRfa2V5cy5qc29uCiMgMS4yLiB3cml0ZSB0aGUgcm9vdCB0b2tlbiBpbnRvIC9yb290Ly52YXVsdC10b2tlbgojIDIuIENoZWNrIGlmIHZhdWx0IGlzIHNlYWxlZAojIDIuMS4gVmFsaWRhdGUgL3Jvb3QvdmF1bHRfa2V5cy5qc29uIGhhcyB1bnNlYWwga2V5cwojIDIuMi4gVW5zZWFsIHZhdWx0CgpleHBvcnQgVkFVTFRfQUREUj1odHRwczovLzEyNy4wLjAuMTo4MjAwCmV4cG9ydCBLRVlTX0ZJTEU9L3Jvb3QvdmF1bHRfa2V5cy5qc29uCgp2YXVsdF9pc19pbml0aWFsaXplZCgpIHsKICBjdXJsIC1zICRWQVVMVF9BRERSL3YxL3N5cy9pbml0IHwganEgLWUgLmluaXRpYWxpemVkID4gL2Rldi9udWxsCiAgcmV0dXJuICQ/Cn0KCnZhdWx0X2lzX3NlYWxlZCgpIHsKICBjdXJsIC1zICRWQVVMVF9BRERSL3YxL3N5cy9oZWFsdGggfCBqcSAtZSAuc2VhbGVkID4gL2Rldi9udWxsCiAgcmV0dXJuICQ/Cn0KCmluaXRpYWxpemVfdmF1bHQoKSB7CiAgY3VybCAtcyAkVkFVTFRfQUREUi92MS9zeXMvaW5pdCAtWCBQVVQgLWQgJ3sic2VjcmV0X3NoYXJlcyI6IDMsICJzZWNyZXRfdGhyZXNob2xkIjogM30nID4gJEtFWVNfRklMRQogIHJldHZhbD0kPwogIHJldHVybiAkcmV0dmFsCn0KCnZhdWx0X3Jvb3RfbG9naW4oKSB7CiAgY2F0ICRLRVlTX0ZJTEUgfCBqcSAtciAucm9vdF90b2tlbiA+IC9yb290Ly52YXVsdC10b2tlbgp9Cgp1bnNlYWxfdmF1bHQoKSB7CiAgaWYganEgLWUgIigua2V5cyB8IGxlbmd0aCkgPiAwIiAkS0VZU19GSUxFOyB0aGVuCiAgICBlY2hvIGhpID4gL2Rldi9udWxsCiAgZWxzZQogICAgZWNobyAiTWlzc2luZyBrZXlzIGluICRLRVlTX0ZJTEUiCiAgICBleGl0IDEKICBmaQogIENPVU5URVI9MAogIHdoaWxlIHZhdWx0X2lzX3NlYWxlZDsgZG8KICAgIF9rZXk9JChjYXQgJEtFWVNfRklMRSB8IGpxIC1yICIua2V5c1skQ09VTlRFUl0iKQogICAgQ09VTlRFUj0kKCgkQ09VTlRFUisxKSkKICAgIGN1cmwgLXMgJFZBVUxUX0FERFIvdjEvc3lzL3Vuc2VhbCAtWCBQVVQgLWQgInsia2V5IjoiJF9rZXkifSIKICBkb25lCn0KCnZhdWx0X2lzX3VwKCkgewogIGN1cmwgLXMgJFZBVUxUX0FERFIvdjEvc3lzL2hlYWx0aCA+IC9kZXYvbnVsbAp9Cgp3YWl0X2Zvcl92YXVsdF9zZXJ2ZXIoKSB7CiAgVElNRU9VVF9TRUNPTkRTPSR7MTotNjB9CiAgVElNRU9VVF9USU1FPSQoKCAkVElNRU9VVF9TRUNPTkRTICsgJChkYXRlICslcykgKSkKICB1bnRpbCB2YXVsdF9pc191cDsgZG8KICAgIFsgJChkYXRlICslcykgLWx0ICRUSU1FT1VUX1RJTUUgXSB8fCBleGl0IDIKICAgIHNsZWVwIDEKICBkb25lCn0KCm1haW4oKSB7CiAgd2FpdF9mb3JfdmF1bHRfc2VydmVyCiAgdmF1bHRfaXNfaW5pdGlhbGl6ZWQgfHwgaW5pdGlhbGl6ZV92YXVsdAogIHVuc2VhbF92YXVsdAogIHZhdWx0X3Jvb3RfbG9naW4KfQoKbWFpbgo=\nFILE_CONTENT\nchown vault:vault /etc/vault.d/scripts/post_start.sh\nchmod 0755 /etc/vault.d/scripts/post_start.sh\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/systemd/system/vault.service\nW1VuaXRdCkRlc2NyaXB0aW9uPXZhdWx0CkRvY3VtZW50YXRpb249aHR0cDovL2xvY2FsaG9zdApbU2VydmljZV0KQW1iaWVudENhcGFiaWxpdGllcz1DQVBfSVBDX0xPQ0sKQ2FwYWJpbGl0aWVzPUNBUF9JUENfTE9DSytlcApDYXBhYmlsaXR5Qm91bmRpbmdTZXQ9Q0FQX1NZU0xPRyBDQVBfSVBDX0xPQ0sKRXhlY1JlbG9hZD0vYmluL2tpbGwgLS1zaWduYWwgSFVQICRNQUlOUElECkV4ZWNTdGFydD0vdXNyL2xvY2FsL2Jpbi92YXVsdCBzZXJ2ZXIgLWNvbmZpZz0vZXRjL3ZhdWx0LmQvdmF1bHQuaGNsCkV4ZWNTdGFydFBvc3Q9L2V0Yy92YXVsdC5kL3NjcmlwdHMvcG9zdF9zdGFydC5zaApHcm91cD12YXVsdApLaWxsTW9kZT1wcm9jZXNzCktpbGxTaWduYWw9U0lHSU5UCkxpbWl0TUVNTE9DSz1pbmZpbml0eQpMaW1pdE5PRklMRT02NTUzNgpOb05ld1ByaXZpbGVnZXM9eWVzClByaXZhdGVEZXZpY2VzPXllcwpQcml2YXRlVG1wPXllcwpQcm90ZWN0SG9tZT1yZWFkLW9ubHkKUHJvdGVjdFN5c3RlbT1mdWxsClJlc3RhcnQ9b24tZmFpbHVyZQpSZXN0YXJ0U2VjPTUKU2VjdXJlQml0cz1rZWVwLWNhcHMKVGltZW91dFN0b3BTZWM9MzAKVXNlcj12YXVsdApbSW5zdGFsbF0KV2FudGVkQnk9bXVsdGktdXNlci50YXJnZXQ=\nFILE_CONTENT\nchown root:root /etc/systemd/system/vault.service\nchmod 0644 /etc/systemd/system/vault.service\nsystemctl start vault\nsystemctl enable vault\napt-get install -y apt-transport-https ca-certificates curl gnupg-agent software-properties-common\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -\nsudo add-apt-repository  \"deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\" \napt-get update\napt-get install -y docker-ce docker-ce-cli containerd.io\nmkdir -p /etc/nomad.d\nchown root:root /etc/nomad.d\nchmod 700 /etc/nomad.d\nmkdir -p /opt/nomad\nchown root:root /opt/nomad\nchmod 0755 /opt/nomad\ncurl -L https://releases.hashicorp.com/nomad/0.10.4/nomad_0.10.4_linux_amd64.zip -o /tmp/nomad-0.10.4.zip\nchown root:root /tmp/nomad-0.10.4.zip\nchmod 0644 /tmp/nomad-0.10.4.zip\nunzip -x /tmp/nomad-0.10.4.zip -d /usr/local/bin\nrm /tmp/nomad-0.10.4.zip\nnomad -autocomplete-install\ncomplete -C /usr/local/bin/nomad nomad\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/nomad.d/nomad.hcl\nZGF0YV9kaXIgPSAiL29wdC9ub21hZCI=\nFILE_CONTENT\nchown root:root /etc/nomad.d/nomad.hcl\nchmod 0644 /etc/nomad.d/nomad.hcl\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/nomad.d/datacenter.hcl\nZGF0YWNlbnRlciA9ICJhbXMzYzAxIg==\nFILE_CONTENT\nchown root:root /etc/nomad.d/datacenter.hcl\nchmod 0644 /etc/nomad.d/datacenter.hcl\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/nomad.d/client.hcl\nY2xpZW50IHsKICBlbmFibGVkID0gdHJ1ZQp9Cg==\nFILE_CONTENT\nchown root:root /etc/nomad.d/client.hcl\nchmod 0644 /etc/nomad.d/client.hcl\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/nomad.d/server.hcl\nc2VydmVyIHsKICBlbmFibGVkID0gdHJ1ZQogIGJvb3RzdHJhcF9leHBlY3QgPSAzCn0K\nFILE_CONTENT\nchown root:root /etc/nomad.d/server.hcl\nchmod 0644 /etc/nomad.d/server.hcl\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/nomad.d/99-additional-configs.hcl\nYWR2ZXJ0aXNlIHsKICAgIGh0dHAgPSAie3tHZXRQdWJsaWNJUH19IgogICAgcnBjID0gInt7R2V0UHVibGljSVB9fSIKICAgIHNlcmYgPSAie3tHZXRQdWJsaWNJUH19Igp9Cg==\nFILE_CONTENT\nchown root:root /etc/nomad.d/99-additional-configs.hcl\nchmod 0644 /etc/nomad.d/99-additional-configs.hcl\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/systemd/system/nomad.service\nW1VuaXRdCkRlc2NyaXB0aW9uPW5vbWFkCkRvY3VtZW50YXRpb249aHR0cDovL2xvY2FsaG9zdApbU2VydmljZV0KRXhlY1JlbG9hZD0vYmluL2tpbGwgLUhVUCAkTUFJTlBJRApFeGVjU3RhcnQ9L3Vzci9sb2NhbC9iaW4vbm9tYWQgYWdlbnQgLWNvbmZpZyAvZXRjL25vbWFkLmQKS2lsbE1vZGU9cHJvY2VzcwpLaWxsU2lnbmFsPVNJR0lOVApMaW1pdE5PRklMRT1pbmZpbml0eQpMaW1pdE5QUk9DPWluZmluaXR5ClJlc3RhcnQ9b24tZmFpbHVyZQpSZXN0YXJ0U2VjPTIKU3RhcnRMaW1pdEJ1cnN0PTMKU3RhcnRMaW1pdEludGVydmFsU2VjPTEwClRhc2tzTWF4PWluZmluaXR5CltJbnN0YWxsXQpXYW50ZWRCeT1tdWx0aS11c2VyLnRhcmdldA==\nFILE_CONTENT\nchown root:root /etc/systemd/system/nomad.service\nchmod 0644 /etc/systemd/system/nomad.service\nsystemctl start nomad\nsystemctl enable nomad",
          "lifecycle": {
            "create_before_destroy": true,
            "ignore_changes": [
              "user_data"
            ]
          }
        },
        "server-4-ams3-c01": {
          "image": "ubuntu-18-04-x64",
          "name": "${random_pet.server-4-ams3-c01.id}",
          "private_networking": true,
          "region": "ams3",
          "size": "s-1vcpu-1gb",
          "ssh_keys": [
            "${digitalocean_ssh_key.smintz-0.id}"
          ],
          "tags": [
            "server",
            "c01"
          ],
          "user_data": "#!/bin/bash\napt-get update\napt-get install -y unzip curl jq dnsutils\nuseradd --system --home /etc/consul.d --shell /bin/false consul\nmkdir -p /etc/consul.d\nchown root:root /etc/consul.d\nchmod 0755 /etc/consul.d\nmkdir -p /opt/consul\nchown consul:consul /opt/consul\nchmod 0755 /opt/consul\ncurl -L https://releases.hashicorp.com/consul/1.7.1/consul_1.7.1_linux_amd64.zip -o /tmp/consul-1.7.1.zip\nchown root:root /tmp/consul-1.7.1.zip\nchmod 0644 /tmp/consul-1.7.1.zip\nunzip -x /tmp/consul-1.7.1.zip -d /usr/local/bin\nrm /tmp/consul-1.7.1.zip\nconsul -autocomplete-install\ncomplete -C /usr/local/bin/consul consul\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/systemd/network/consul0.netdev\nIyBDcmVhdGVzIGEgImR1bW15IiBuZXR3b3JrIGludGVyZmFjZQojIHdlJ2xsIGNvbmZpZ3VyZSB0aGlzIGludGVyZmFjZSB3aXRoIGEgbGluay1sb2NhbCBhZGRyZXNzCiMgU2VlOiBodHRwczovL3d3dy5mcmVlZGVza3RvcC5vcmcvc29mdHdhcmUvc3lzdGVtZC9tYW4vc3lzdGVtZC5uZXRkZXYuaHRtbAojIwoKW05ldERldl0KTmFtZT1jb25zdWwwCktpbmQ9ZHVtbXkK\nFILE_CONTENT\nchown root:root /etc/systemd/network/consul0.netdev\nchmod 0644 /etc/systemd/network/consul0.netdev\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/systemd/network/consul0.network\nIyBXZSAiZmluZCIgdGhlIGR1bW15MCBpbnRlcmZhY2Ugd2UgY3JlYXRlZCBhbmQgY29uZmlndXJlIGl0IHdpdGggYSBsaW5rLWxvY2FsIGFkZHJlc3MKIyBTZWU6IGh0dHBzOi8vd3d3LmZyZWVkZXNrdG9wLm9yZy9zb2Z0d2FyZS9zeXN0ZW1kL21hbi9zeXN0ZW1kLm5ldHdvcmsuaHRtbAojIwpbTWF0Y2hdCk5hbWU9Y29uc3VsMAoKW05ldHdvcmtdCkFkZHJlc3M9MTY5LjI1NC4xLjEvMzIKCiMgV2Ugd2FudCB0aGVzZSBkb21haW5zCkRvbWFpbnM9IH5wY28ubmYuCgojIFRvIGdvIHRvIHRoZSBjb25zdWwgRE5TIHNlcnZlciB3ZSdsbCBiaW5kIHRvIHRoaXMgYWRkcmVzcwpETlM9MTY5LjI1NC4xLjEK\nFILE_CONTENT\nchown root:root /etc/systemd/network/consul0.network\nchmod 0644 /etc/systemd/network/consul0.network\nsystemctl restart systemd-networkd\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/consul.d/config.hcl\ndWkgPSB0cnVlCmJpbmRfYWRkciA9ICIwLjAuMC4wIgphZHZlcnRpc2VfYWRkciA9ICJ7e0dldFB1YmxpY0lQfX0iCmRhdGFjZW50ZXIgPSAiYW1zM2MwMSIKZGF0YV9kaXIgPSAiL29wdC9jb25zdWwiCmRvbWFpbiA9ICJwY28ubmYi\nFILE_CONTENT\nchown consul:consul /etc/consul.d/config.hcl\nchmod 0640 /etc/consul.d/config.hcl\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/consul.d/server.hcl\nc2VydmVyID0gdHJ1ZQpib290c3RyYXBfZXhwZWN0ID0gMw==\nFILE_CONTENT\nchown consul:consul /etc/consul.d/server.hcl\nchmod 0640 /etc/consul.d/server.hcl\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /usr/local/share/ca-certificates/protoconf.crt\nJHt0bHNfc2VsZl9zaWduZWRfY2VydC5yb290LmNlcnRfcGVtfQ==\nFILE_CONTENT\nchown root:root /usr/local/share/ca-certificates/protoconf.crt\nchmod 0644 /usr/local/share/ca-certificates/protoconf.crt\nupdate-ca-certificates\nmkdir -p /etc/consul.d/tls\nchown root:root /etc/consul.d/tls\nchmod 0755 /etc/consul.d/tls\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/consul.d/tls/key.pem\nJHt0bHNfcHJpdmF0ZV9rZXkuc2VydmVyLTQtYW1zMy1jMDEtY29uc3VsLnByaXZhdGVfa2V5X3BlbX0=\nFILE_CONTENT\nchown consul:consul /etc/consul.d/tls/key.pem\nchmod 600 /etc/consul.d/tls/key.pem\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/consul.d/tls/cert.pem\nJHt0bHNfbG9jYWxseV9zaWduZWRfY2VydC5zZXJ2ZXItNC1hbXMzLWMwMS1jb25zdWwuY2VydF9wZW19\nFILE_CONTENT\nchown consul:consul /etc/consul.d/tls/cert.pem\nchmod 0644 /etc/consul.d/tls/cert.pem\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/consul.d/tls.hcl\na2V5X2ZpbGUgPSAiL2V0Yy9jb25zdWwuZC90bHMva2V5LnBlbSIKY2VydF9maWxlID0gIi9ldGMvY29uc3VsLmQvdGxzL2NlcnQucGVtIgpjYV9maWxlID0gIi91c3IvbG9jYWwvc2hhcmUvY2EtY2VydGlmaWNhdGVzL3Byb3RvY29uZi5jcnQiCmFkZHJlc3NlcyB7CiAgICBodHRwcyA9ICIwLjAuMC4wIgogICAgZG5zID0gIjE2OS4yNTQuMS4xIgp9CnBvcnRzIHsKICAgIGh0dHBzID0gODUwMQogICAgZG5zID0gNTMKfQpyZWN1cnNvcnMgPSBbIjEyNy4wLjAuNTMiXQo=\nFILE_CONTENT\nchown root:root /etc/consul.d/tls.hcl\nchmod 0644 /etc/consul.d/tls.hcl\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/consul.d/join_lan.hcl\ncmV0cnlfam9pbiA9IFsicHJvdmlkZXI9ZGlnaXRhbG9jZWFuIGFwaV90b2tlbj0ke3Zhci5kaWdpdGFsb2NlYW5fdG9rZW59IHJlZ2lvbj1hbXMzIHRhZ19uYW1lPXNlcnZlciJd\nFILE_CONTENT\nchown consul:consul /etc/consul.d/join_lan.hcl\nchmod 0640 /etc/consul.d/join_lan.hcl\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/systemd/system/consul.service\nW1VuaXRdCkFmdGVyPW5ldHdvcmstb25saW5lLnRhcmdldApEZXNjcmlwdGlvbj1IYXNoaUNvcnAgQ29uc3VsIC0gQSBzZXJ2aWNlIG1lc2ggc29sdXRpb24KRG9jdW1lbnRhdGlvbj1odHRwczovL3d3dy5jb25zdWwuaW8vClJlcXVpcmVzPW5ldHdvcmstb25saW5lLnRhcmdldApbU2VydmljZV0KQW1iaWVudENhcGFiaWxpdGllcz1DQVBfTkVUX0JJTkRfU0VSVklDRQpFeGVjUmVsb2FkPS91c3IvbG9jYWwvYmluL2NvbnN1bCByZWxvYWQKRXhlY1N0YXJ0PS91c3IvbG9jYWwvYmluL2NvbnN1bCBhZ2VudCAtY29uZmlnLWRpcj0vZXRjL2NvbnN1bC5kLwpHcm91cD1jb25zdWwKS2lsbE1vZGU9cHJvY2VzcwpMaW1pdE5PRklMRT02NTUzNgpSZXN0YXJ0PW9uLWZhaWx1cmUKVHlwZT1ub3RpZnkKVXNlcj1jb25zdWwKW0luc3RhbGxdCldhbnRlZEJ5PW11bHRpLXVzZXIudGFyZ2V0\nFILE_CONTENT\nchown root:root /etc/systemd/system/consul.service\nchmod 0644 /etc/systemd/system/consul.service\nsystemctl start consul\nsystemctl enable consul\ncurl -L https://releases.hashicorp.com/vault/1.3.2/vault_1.3.2_linux_amd64.zip -o /tmp/vault-1.3.2.zip\nchown root:root /tmp/vault-1.3.2.zip\nchmod 0644 /tmp/vault-1.3.2.zip\nunzip -x /tmp/vault-1.3.2.zip -d /usr/local/bin\nrm /tmp/vault-1.3.2.zip\nvault -autocomplete-install\nsetcap cap_ipc_lock=+ep /usr/local/bin/vault\nuseradd --system --home /etc/vault.d --shell /bin/false vault\nmkdir -p /etc/vault.d\nchown vault:vault /etc/vault.d\nchmod 0755 /etc/vault.d\nmkdir -p /etc/vault.d/tls\nchown root:root /etc/vault.d/tls\nchmod 0755 /etc/vault.d/tls\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/vault.d/tls/key.pem\nJHt0bHNfcHJpdmF0ZV9rZXkuc2VydmVyLTQtYW1zMy1jMDEtdmF1bHQucHJpdmF0ZV9rZXlfcGVtfQ==\nFILE_CONTENT\nchown vault:vault /etc/vault.d/tls/key.pem\nchmod 600 /etc/vault.d/tls/key.pem\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/vault.d/tls/cert.pem\nJHt0bHNfbG9jYWxseV9zaWduZWRfY2VydC5zZXJ2ZXItNC1hbXMzLWMwMS12YXVsdC5jZXJ0X3BlbX0=\nFILE_CONTENT\nchown vault:vault /etc/vault.d/tls/cert.pem\nchmod 0644 /etc/vault.d/tls/cert.pem\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/vault.d/vault.hcl\ndWkgPSB0cnVlCnN0b3JhZ2UgImNvbnN1bCIgewogICAgcGF0aCA9ICJ2YXVsdC8iCn0KbGlzdGVuZXIgInRjcCIgewogIGFkZHJlc3MgICAgICAgPSAiMC4wLjAuMDo4MjAwIgogIHRsc19jZXJ0X2ZpbGUgPSAiL2V0Yy92YXVsdC5kL3Rscy9jZXJ0LnBlbSIKICB0bHNfa2V5X2ZpbGUgID0gIi9ldGMvdmF1bHQuZC90bHMva2V5LnBlbSIKfQo=\nFILE_CONTENT\nchown root:root /etc/vault.d/vault.hcl\nchmod 0644 /etc/vault.d/vault.hcl\nmkdir -p /etc/vault.d/scripts\nchown vault:vault /etc/vault.d/scripts\nchmod 0755 /etc/vault.d/scripts\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/vault.d/scripts/post_start.sh\nIyEvYmluL2Jhc2gKCiMgVGhpcyBzY3JpcHQgd2lsbCBydW4gYWZ0ZXIgZXZlcnkgdGltZSB2YXVsdCBpcyBzdGFydGVkLiBJdCB3aWxsIHRyeSB0bzoKIyAxLiBWYWxpZGF0ZSBpZiB2YXVsdCBpcyBpbml0aWFsaXplZAojIDEuMS4gaW5pdGlhbGl6ZSB2YXVsdCBhbmQgc2F2ZSB0aGUgdW5zZWFsIGtleXMgaW4gL3Jvb3QvdmF1bHRfa2V5cy5qc29uCiMgMS4yLiB3cml0ZSB0aGUgcm9vdCB0b2tlbiBpbnRvIC9yb290Ly52YXVsdC10b2tlbgojIDIuIENoZWNrIGlmIHZhdWx0IGlzIHNlYWxlZAojIDIuMS4gVmFsaWRhdGUgL3Jvb3QvdmF1bHRfa2V5cy5qc29uIGhhcyB1bnNlYWwga2V5cwojIDIuMi4gVW5zZWFsIHZhdWx0CgpleHBvcnQgVkFVTFRfQUREUj1odHRwczovLzEyNy4wLjAuMTo4MjAwCmV4cG9ydCBLRVlTX0ZJTEU9L3Jvb3QvdmF1bHRfa2V5cy5qc29uCgp2YXVsdF9pc19pbml0aWFsaXplZCgpIHsKICBjdXJsIC1zICRWQVVMVF9BRERSL3YxL3N5cy9pbml0IHwganEgLWUgLmluaXRpYWxpemVkID4gL2Rldi9udWxsCiAgcmV0dXJuICQ/Cn0KCnZhdWx0X2lzX3NlYWxlZCgpIHsKICBjdXJsIC1zICRWQVVMVF9BRERSL3YxL3N5cy9oZWFsdGggfCBqcSAtZSAuc2VhbGVkID4gL2Rldi9udWxsCiAgcmV0dXJuICQ/Cn0KCmluaXRpYWxpemVfdmF1bHQoKSB7CiAgY3VybCAtcyAkVkFVTFRfQUREUi92MS9zeXMvaW5pdCAtWCBQVVQgLWQgJ3sic2VjcmV0X3NoYXJlcyI6IDMsICJzZWNyZXRfdGhyZXNob2xkIjogM30nID4gJEtFWVNfRklMRQogIHJldHZhbD0kPwogIHJldHVybiAkcmV0dmFsCn0KCnZhdWx0X3Jvb3RfbG9naW4oKSB7CiAgY2F0ICRLRVlTX0ZJTEUgfCBqcSAtciAucm9vdF90b2tlbiA+IC9yb290Ly52YXVsdC10b2tlbgp9Cgp1bnNlYWxfdmF1bHQoKSB7CiAgaWYganEgLWUgIigua2V5cyB8IGxlbmd0aCkgPiAwIiAkS0VZU19GSUxFOyB0aGVuCiAgICBlY2hvIGhpID4gL2Rldi9udWxsCiAgZWxzZQogICAgZWNobyAiTWlzc2luZyBrZXlzIGluICRLRVlTX0ZJTEUiCiAgICBleGl0IDEKICBmaQogIENPVU5URVI9MAogIHdoaWxlIHZhdWx0X2lzX3NlYWxlZDsgZG8KICAgIF9rZXk9JChjYXQgJEtFWVNfRklMRSB8IGpxIC1yICIua2V5c1skQ09VTlRFUl0iKQogICAgQ09VTlRFUj0kKCgkQ09VTlRFUisxKSkKICAgIGN1cmwgLXMgJFZBVUxUX0FERFIvdjEvc3lzL3Vuc2VhbCAtWCBQVVQgLWQgInsia2V5IjoiJF9rZXkifSIKICBkb25lCn0KCnZhdWx0X2lzX3VwKCkgewogIGN1cmwgLXMgJFZBVUxUX0FERFIvdjEvc3lzL2hlYWx0aCA+IC9kZXYvbnVsbAp9Cgp3YWl0X2Zvcl92YXVsdF9zZXJ2ZXIoKSB7CiAgVElNRU9VVF9TRUNPTkRTPSR7MTotNjB9CiAgVElNRU9VVF9USU1FPSQoKCAkVElNRU9VVF9TRUNPTkRTICsgJChkYXRlICslcykgKSkKICB1bnRpbCB2YXVsdF9pc191cDsgZG8KICAgIFsgJChkYXRlICslcykgLWx0ICRUSU1FT1VUX1RJTUUgXSB8fCBleGl0IDIKICAgIHNsZWVwIDEKICBkb25lCn0KCm1haW4oKSB7CiAgd2FpdF9mb3JfdmF1bHRfc2VydmVyCiAgdmF1bHRfaXNfaW5pdGlhbGl6ZWQgfHwgaW5pdGlhbGl6ZV92YXVsdAogIHVuc2VhbF92YXVsdAogIHZhdWx0X3Jvb3RfbG9naW4KfQoKbWFpbgo=\nFILE_CONTENT\nchown vault:vault /etc/vault.d/scripts/post_start.sh\nchmod 0755 /etc/vault.d/scripts/post_start.sh\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/systemd/system/vault.service\nW1VuaXRdCkRlc2NyaXB0aW9uPXZhdWx0CkRvY3VtZW50YXRpb249aHR0cDovL2xvY2FsaG9zdApbU2VydmljZV0KQW1iaWVudENhcGFiaWxpdGllcz1DQVBfSVBDX0xPQ0sKQ2FwYWJpbGl0aWVzPUNBUF9JUENfTE9DSytlcApDYXBhYmlsaXR5Qm91bmRpbmdTZXQ9Q0FQX1NZU0xPRyBDQVBfSVBDX0xPQ0sKRXhlY1JlbG9hZD0vYmluL2tpbGwgLS1zaWduYWwgSFVQICRNQUlOUElECkV4ZWNTdGFydD0vdXNyL2xvY2FsL2Jpbi92YXVsdCBzZXJ2ZXIgLWNvbmZpZz0vZXRjL3ZhdWx0LmQvdmF1bHQuaGNsCkV4ZWNTdGFydFBvc3Q9L2V0Yy92YXVsdC5kL3NjcmlwdHMvcG9zdF9zdGFydC5zaApHcm91cD12YXVsdApLaWxsTW9kZT1wcm9jZXNzCktpbGxTaWduYWw9U0lHSU5UCkxpbWl0TUVNTE9DSz1pbmZpbml0eQpMaW1pdE5PRklMRT02NTUzNgpOb05ld1ByaXZpbGVnZXM9eWVzClByaXZhdGVEZXZpY2VzPXllcwpQcml2YXRlVG1wPXllcwpQcm90ZWN0SG9tZT1yZWFkLW9ubHkKUHJvdGVjdFN5c3RlbT1mdWxsClJlc3RhcnQ9b24tZmFpbHVyZQpSZXN0YXJ0U2VjPTUKU2VjdXJlQml0cz1rZWVwLWNhcHMKVGltZW91dFN0b3BTZWM9MzAKVXNlcj12YXVsdApbSW5zdGFsbF0KV2FudGVkQnk9bXVsdGktdXNlci50YXJnZXQ=\nFILE_CONTENT\nchown root:root /etc/systemd/system/vault.service\nchmod 0644 /etc/systemd/system/vault.service\nsystemctl start vault\nsystemctl enable vault\napt-get install -y apt-transport-https ca-certificates curl gnupg-agent software-properties-common\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -\nsudo add-apt-repository  \"deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\" \napt-get update\napt-get install -y docker-ce docker-ce-cli containerd.io\nmkdir -p /etc/nomad.d\nchown root:root /etc/nomad.d\nchmod 700 /etc/nomad.d\nmkdir -p /opt/nomad\nchown root:root /opt/nomad\nchmod 0755 /opt/nomad\ncurl -L https://releases.hashicorp.com/nomad/0.10.4/nomad_0.10.4_linux_amd64.zip -o /tmp/nomad-0.10.4.zip\nchown root:root /tmp/nomad-0.10.4.zip\nchmod 0644 /tmp/nomad-0.10.4.zip\nunzip -x /tmp/nomad-0.10.4.zip -d /usr/local/bin\nrm /tmp/nomad-0.10.4.zip\nnomad -autocomplete-install\ncomplete -C /usr/local/bin/nomad nomad\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/nomad.d/nomad.hcl\nZGF0YV9kaXIgPSAiL29wdC9ub21hZCI=\nFILE_CONTENT\nchown root:root /etc/nomad.d/nomad.hcl\nchmod 0644 /etc/nomad.d/nomad.hcl\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/nomad.d/datacenter.hcl\nZGF0YWNlbnRlciA9ICJhbXMzYzAxIg==\nFILE_CONTENT\nchown root:root /etc/nomad.d/datacenter.hcl\nchmod 0644 /etc/nomad.d/datacenter.hcl\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/nomad.d/client.hcl\nY2xpZW50IHsKICBlbmFibGVkID0gdHJ1ZQp9Cg==\nFILE_CONTENT\nchown root:root /etc/nomad.d/client.hcl\nchmod 0644 /etc/nomad.d/client.hcl\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/nomad.d/server.hcl\nc2VydmVyIHsKICBlbmFibGVkID0gdHJ1ZQogIGJvb3RzdHJhcF9leHBlY3QgPSAzCn0K\nFILE_CONTENT\nchown root:root /etc/nomad.d/server.hcl\nchmod 0644 /etc/nomad.d/server.hcl\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/nomad.d/99-additional-configs.hcl\nYWR2ZXJ0aXNlIHsKICAgIGh0dHAgPSAie3tHZXRQdWJsaWNJUH19IgogICAgcnBjID0gInt7R2V0UHVibGljSVB9fSIKICAgIHNlcmYgPSAie3tHZXRQdWJsaWNJUH19Igp9Cg==\nFILE_CONTENT\nchown root:root /etc/nomad.d/99-additional-configs.hcl\nchmod 0644 /etc/nomad.d/99-additional-configs.hcl\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/systemd/system/nomad.service\nW1VuaXRdCkRlc2NyaXB0aW9uPW5vbWFkCkRvY3VtZW50YXRpb249aHR0cDovL2xvY2FsaG9zdApbU2VydmljZV0KRXhlY1JlbG9hZD0vYmluL2tpbGwgLUhVUCAkTUFJTlBJRApFeGVjU3RhcnQ9L3Vzci9sb2NhbC9iaW4vbm9tYWQgYWdlbnQgLWNvbmZpZyAvZXRjL25vbWFkLmQKS2lsbE1vZGU9cHJvY2VzcwpLaWxsU2lnbmFsPVNJR0lOVApMaW1pdE5PRklMRT1pbmZpbml0eQpMaW1pdE5QUk9DPWluZmluaXR5ClJlc3RhcnQ9b24tZmFpbHVyZQpSZXN0YXJ0U2VjPTIKU3RhcnRMaW1pdEJ1cnN0PTMKU3RhcnRMaW1pdEludGVydmFsU2VjPTEwClRhc2tzTWF4PWluZmluaXR5CltJbnN0YWxsXQpXYW50ZWRCeT1tdWx0aS11c2VyLnRhcmdldA==\nFILE_CONTENT\nchown root:root /etc/systemd/system/nomad.service\nchmod 0644 /etc/systemd/system/nomad.service\nsystemctl start nomad\nsystemctl enable nomad",
          "lifecycle": {
            "create_before_destroy": true,
            "ignore_changes": [
              "user_data"
            ]
          }
        },
        "server-5-ams3-c01": {
          "image": "ubuntu-18-04-x64",
          "name": "${random_pet.server-5-ams3-c01.id}",
          "private_networking": true,
          "region": "ams3",
          "size": "s-1vcpu-1gb",
          "ssh_keys": [
            "${digitalocean_ssh_key.smintz-0.id}"
          ],
          "tags": [
            "server",
            "c01"
          ],
          "user_data": "#!/bin/bash\napt-get update\napt-get install -y unzip curl jq dnsutils\nuseradd --system --home /etc/consul.d --shell /bin/false consul\nmkdir -p /etc/consul.d\nchown root:root /etc/consul.d\nchmod 0755 /etc/consul.d\nmkdir -p /opt/consul\nchown consul:consul /opt/consul\nchmod 0755 /opt/consul\ncurl -L https://releases.hashicorp.com/consul/1.7.1/consul_1.7.1_linux_amd64.zip -o /tmp/consul-1.7.1.zip\nchown root:root /tmp/consul-1.7.1.zip\nchmod 0644 /tmp/consul-1.7.1.zip\nunzip -x /tmp/consul-1.7.1.zip -d /usr/local/bin\nrm /tmp/consul-1.7.1.zip\nconsul -autocomplete-install\ncomplete -C /usr/local/bin/consul consul\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/systemd/network/consul0.netdev\nIyBDcmVhdGVzIGEgImR1bW15IiBuZXR3b3JrIGludGVyZmFjZQojIHdlJ2xsIGNvbmZpZ3VyZSB0aGlzIGludGVyZmFjZSB3aXRoIGEgbGluay1sb2NhbCBhZGRyZXNzCiMgU2VlOiBodHRwczovL3d3dy5mcmVlZGVza3RvcC5vcmcvc29mdHdhcmUvc3lzdGVtZC9tYW4vc3lzdGVtZC5uZXRkZXYuaHRtbAojIwoKW05ldERldl0KTmFtZT1jb25zdWwwCktpbmQ9ZHVtbXkK\nFILE_CONTENT\nchown root:root /etc/systemd/network/consul0.netdev\nchmod 0644 /etc/systemd/network/consul0.netdev\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/systemd/network/consul0.network\nIyBXZSAiZmluZCIgdGhlIGR1bW15MCBpbnRlcmZhY2Ugd2UgY3JlYXRlZCBhbmQgY29uZmlndXJlIGl0IHdpdGggYSBsaW5rLWxvY2FsIGFkZHJlc3MKIyBTZWU6IGh0dHBzOi8vd3d3LmZyZWVkZXNrdG9wLm9yZy9zb2Z0d2FyZS9zeXN0ZW1kL21hbi9zeXN0ZW1kLm5ldHdvcmsuaHRtbAojIwpbTWF0Y2hdCk5hbWU9Y29uc3VsMAoKW05ldHdvcmtdCkFkZHJlc3M9MTY5LjI1NC4xLjEvMzIKCiMgV2Ugd2FudCB0aGVzZSBkb21haW5zCkRvbWFpbnM9IH5wY28ubmYuCgojIFRvIGdvIHRvIHRoZSBjb25zdWwgRE5TIHNlcnZlciB3ZSdsbCBiaW5kIHRvIHRoaXMgYWRkcmVzcwpETlM9MTY5LjI1NC4xLjEK\nFILE_CONTENT\nchown root:root /etc/systemd/network/consul0.network\nchmod 0644 /etc/systemd/network/consul0.network\nsystemctl restart systemd-networkd\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/consul.d/config.hcl\ndWkgPSB0cnVlCmJpbmRfYWRkciA9ICIwLjAuMC4wIgphZHZlcnRpc2VfYWRkciA9ICJ7e0dldFB1YmxpY0lQfX0iCmRhdGFjZW50ZXIgPSAiYW1zM2MwMSIKZGF0YV9kaXIgPSAiL29wdC9jb25zdWwiCmRvbWFpbiA9ICJwY28ubmYi\nFILE_CONTENT\nchown consul:consul /etc/consul.d/config.hcl\nchmod 0640 /etc/consul.d/config.hcl\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/consul.d/server.hcl\nc2VydmVyID0gdHJ1ZQpib290c3RyYXBfZXhwZWN0ID0gMw==\nFILE_CONTENT\nchown consul:consul /etc/consul.d/server.hcl\nchmod 0640 /etc/consul.d/server.hcl\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /usr/local/share/ca-certificates/protoconf.crt\nJHt0bHNfc2VsZl9zaWduZWRfY2VydC5yb290LmNlcnRfcGVtfQ==\nFILE_CONTENT\nchown root:root /usr/local/share/ca-certificates/protoconf.crt\nchmod 0644 /usr/local/share/ca-certificates/protoconf.crt\nupdate-ca-certificates\nmkdir -p /etc/consul.d/tls\nchown root:root /etc/consul.d/tls\nchmod 0755 /etc/consul.d/tls\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/consul.d/tls/key.pem\nJHt0bHNfcHJpdmF0ZV9rZXkuc2VydmVyLTUtYW1zMy1jMDEtY29uc3VsLnByaXZhdGVfa2V5X3BlbX0=\nFILE_CONTENT\nchown consul:consul /etc/consul.d/tls/key.pem\nchmod 600 /etc/consul.d/tls/key.pem\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/consul.d/tls/cert.pem\nJHt0bHNfbG9jYWxseV9zaWduZWRfY2VydC5zZXJ2ZXItNS1hbXMzLWMwMS1jb25zdWwuY2VydF9wZW19\nFILE_CONTENT\nchown consul:consul /etc/consul.d/tls/cert.pem\nchmod 0644 /etc/consul.d/tls/cert.pem\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/consul.d/tls.hcl\na2V5X2ZpbGUgPSAiL2V0Yy9jb25zdWwuZC90bHMva2V5LnBlbSIKY2VydF9maWxlID0gIi9ldGMvY29uc3VsLmQvdGxzL2NlcnQucGVtIgpjYV9maWxlID0gIi91c3IvbG9jYWwvc2hhcmUvY2EtY2VydGlmaWNhdGVzL3Byb3RvY29uZi5jcnQiCmFkZHJlc3NlcyB7CiAgICBodHRwcyA9ICIwLjAuMC4wIgogICAgZG5zID0gIjE2OS4yNTQuMS4xIgp9CnBvcnRzIHsKICAgIGh0dHBzID0gODUwMQogICAgZG5zID0gNTMKfQpyZWN1cnNvcnMgPSBbIjEyNy4wLjAuNTMiXQo=\nFILE_CONTENT\nchown root:root /etc/consul.d/tls.hcl\nchmod 0644 /etc/consul.d/tls.hcl\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/consul.d/join_lan.hcl\ncmV0cnlfam9pbiA9IFsicHJvdmlkZXI9ZGlnaXRhbG9jZWFuIGFwaV90b2tlbj0ke3Zhci5kaWdpdGFsb2NlYW5fdG9rZW59IHJlZ2lvbj1hbXMzIHRhZ19uYW1lPXNlcnZlciJd\nFILE_CONTENT\nchown consul:consul /etc/consul.d/join_lan.hcl\nchmod 0640 /etc/consul.d/join_lan.hcl\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/systemd/system/consul.service\nW1VuaXRdCkFmdGVyPW5ldHdvcmstb25saW5lLnRhcmdldApEZXNjcmlwdGlvbj1IYXNoaUNvcnAgQ29uc3VsIC0gQSBzZXJ2aWNlIG1lc2ggc29sdXRpb24KRG9jdW1lbnRhdGlvbj1odHRwczovL3d3dy5jb25zdWwuaW8vClJlcXVpcmVzPW5ldHdvcmstb25saW5lLnRhcmdldApbU2VydmljZV0KQW1iaWVudENhcGFiaWxpdGllcz1DQVBfTkVUX0JJTkRfU0VSVklDRQpFeGVjUmVsb2FkPS91c3IvbG9jYWwvYmluL2NvbnN1bCByZWxvYWQKRXhlY1N0YXJ0PS91c3IvbG9jYWwvYmluL2NvbnN1bCBhZ2VudCAtY29uZmlnLWRpcj0vZXRjL2NvbnN1bC5kLwpHcm91cD1jb25zdWwKS2lsbE1vZGU9cHJvY2VzcwpMaW1pdE5PRklMRT02NTUzNgpSZXN0YXJ0PW9uLWZhaWx1cmUKVHlwZT1ub3RpZnkKVXNlcj1jb25zdWwKW0luc3RhbGxdCldhbnRlZEJ5PW11bHRpLXVzZXIudGFyZ2V0\nFILE_CONTENT\nchown root:root /etc/systemd/system/consul.service\nchmod 0644 /etc/systemd/system/consul.service\nsystemctl start consul\nsystemctl enable consul\ncurl -L https://releases.hashicorp.com/vault/1.3.2/vault_1.3.2_linux_amd64.zip -o /tmp/vault-1.3.2.zip\nchown root:root /tmp/vault-1.3.2.zip\nchmod 0644 /tmp/vault-1.3.2.zip\nunzip -x /tmp/vault-1.3.2.zip -d /usr/local/bin\nrm /tmp/vault-1.3.2.zip\nvault -autocomplete-install\nsetcap cap_ipc_lock=+ep /usr/local/bin/vault\nuseradd --system --home /etc/vault.d --shell /bin/false vault\nmkdir -p /etc/vault.d\nchown vault:vault /etc/vault.d\nchmod 0755 /etc/vault.d\nmkdir -p /etc/vault.d/tls\nchown root:root /etc/vault.d/tls\nchmod 0755 /etc/vault.d/tls\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/vault.d/tls/key.pem\nJHt0bHNfcHJpdmF0ZV9rZXkuc2VydmVyLTUtYW1zMy1jMDEtdmF1bHQucHJpdmF0ZV9rZXlfcGVtfQ==\nFILE_CONTENT\nchown vault:vault /etc/vault.d/tls/key.pem\nchmod 600 /etc/vault.d/tls/key.pem\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/vault.d/tls/cert.pem\nJHt0bHNfbG9jYWxseV9zaWduZWRfY2VydC5zZXJ2ZXItNS1hbXMzLWMwMS12YXVsdC5jZXJ0X3BlbX0=\nFILE_CONTENT\nchown vault:vault /etc/vault.d/tls/cert.pem\nchmod 0644 /etc/vault.d/tls/cert.pem\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/vault.d/vault.hcl\ndWkgPSB0cnVlCnN0b3JhZ2UgImNvbnN1bCIgewogICAgcGF0aCA9ICJ2YXVsdC8iCn0KbGlzdGVuZXIgInRjcCIgewogIGFkZHJlc3MgICAgICAgPSAiMC4wLjAuMDo4MjAwIgogIHRsc19jZXJ0X2ZpbGUgPSAiL2V0Yy92YXVsdC5kL3Rscy9jZXJ0LnBlbSIKICB0bHNfa2V5X2ZpbGUgID0gIi9ldGMvdmF1bHQuZC90bHMva2V5LnBlbSIKfQo=\nFILE_CONTENT\nchown root:root /etc/vault.d/vault.hcl\nchmod 0644 /etc/vault.d/vault.hcl\nmkdir -p /etc/vault.d/scripts\nchown vault:vault /etc/vault.d/scripts\nchmod 0755 /etc/vault.d/scripts\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/vault.d/scripts/post_start.sh\nIyEvYmluL2Jhc2gKCiMgVGhpcyBzY3JpcHQgd2lsbCBydW4gYWZ0ZXIgZXZlcnkgdGltZSB2YXVsdCBpcyBzdGFydGVkLiBJdCB3aWxsIHRyeSB0bzoKIyAxLiBWYWxpZGF0ZSBpZiB2YXVsdCBpcyBpbml0aWFsaXplZAojIDEuMS4gaW5pdGlhbGl6ZSB2YXVsdCBhbmQgc2F2ZSB0aGUgdW5zZWFsIGtleXMgaW4gL3Jvb3QvdmF1bHRfa2V5cy5qc29uCiMgMS4yLiB3cml0ZSB0aGUgcm9vdCB0b2tlbiBpbnRvIC9yb290Ly52YXVsdC10b2tlbgojIDIuIENoZWNrIGlmIHZhdWx0IGlzIHNlYWxlZAojIDIuMS4gVmFsaWRhdGUgL3Jvb3QvdmF1bHRfa2V5cy5qc29uIGhhcyB1bnNlYWwga2V5cwojIDIuMi4gVW5zZWFsIHZhdWx0CgpleHBvcnQgVkFVTFRfQUREUj1odHRwczovLzEyNy4wLjAuMTo4MjAwCmV4cG9ydCBLRVlTX0ZJTEU9L3Jvb3QvdmF1bHRfa2V5cy5qc29uCgp2YXVsdF9pc19pbml0aWFsaXplZCgpIHsKICBjdXJsIC1zICRWQVVMVF9BRERSL3YxL3N5cy9pbml0IHwganEgLWUgLmluaXRpYWxpemVkID4gL2Rldi9udWxsCiAgcmV0dXJuICQ/Cn0KCnZhdWx0X2lzX3NlYWxlZCgpIHsKICBjdXJsIC1zICRWQVVMVF9BRERSL3YxL3N5cy9oZWFsdGggfCBqcSAtZSAuc2VhbGVkID4gL2Rldi9udWxsCiAgcmV0dXJuICQ/Cn0KCmluaXRpYWxpemVfdmF1bHQoKSB7CiAgY3VybCAtcyAkVkFVTFRfQUREUi92MS9zeXMvaW5pdCAtWCBQVVQgLWQgJ3sic2VjcmV0X3NoYXJlcyI6IDMsICJzZWNyZXRfdGhyZXNob2xkIjogM30nID4gJEtFWVNfRklMRQogIHJldHZhbD0kPwogIHJldHVybiAkcmV0dmFsCn0KCnZhdWx0X3Jvb3RfbG9naW4oKSB7CiAgY2F0ICRLRVlTX0ZJTEUgfCBqcSAtciAucm9vdF90b2tlbiA+IC9yb290Ly52YXVsdC10b2tlbgp9Cgp1bnNlYWxfdmF1bHQoKSB7CiAgaWYganEgLWUgIigua2V5cyB8IGxlbmd0aCkgPiAwIiAkS0VZU19GSUxFOyB0aGVuCiAgICBlY2hvIGhpID4gL2Rldi9udWxsCiAgZWxzZQogICAgZWNobyAiTWlzc2luZyBrZXlzIGluICRLRVlTX0ZJTEUiCiAgICBleGl0IDEKICBmaQogIENPVU5URVI9MAogIHdoaWxlIHZhdWx0X2lzX3NlYWxlZDsgZG8KICAgIF9rZXk9JChjYXQgJEtFWVNfRklMRSB8IGpxIC1yICIua2V5c1skQ09VTlRFUl0iKQogICAgQ09VTlRFUj0kKCgkQ09VTlRFUisxKSkKICAgIGN1cmwgLXMgJFZBVUxUX0FERFIvdjEvc3lzL3Vuc2VhbCAtWCBQVVQgLWQgInsia2V5IjoiJF9rZXkifSIKICBkb25lCn0KCnZhdWx0X2lzX3VwKCkgewogIGN1cmwgLXMgJFZBVUxUX0FERFIvdjEvc3lzL2hlYWx0aCA+IC9kZXYvbnVsbAp9Cgp3YWl0X2Zvcl92YXVsdF9zZXJ2ZXIoKSB7CiAgVElNRU9VVF9TRUNPTkRTPSR7MTotNjB9CiAgVElNRU9VVF9USU1FPSQoKCAkVElNRU9VVF9TRUNPTkRTICsgJChkYXRlICslcykgKSkKICB1bnRpbCB2YXVsdF9pc191cDsgZG8KICAgIFsgJChkYXRlICslcykgLWx0ICRUSU1FT1VUX1RJTUUgXSB8fCBleGl0IDIKICAgIHNsZWVwIDEKICBkb25lCn0KCm1haW4oKSB7CiAgd2FpdF9mb3JfdmF1bHRfc2VydmVyCiAgdmF1bHRfaXNfaW5pdGlhbGl6ZWQgfHwgaW5pdGlhbGl6ZV92YXVsdAogIHVuc2VhbF92YXVsdAogIHZhdWx0X3Jvb3RfbG9naW4KfQoKbWFpbgo=\nFILE_CONTENT\nchown vault:vault /etc/vault.d/scripts/post_start.sh\nchmod 0755 /etc/vault.d/scripts/post_start.sh\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/systemd/system/vault.service\nW1VuaXRdCkRlc2NyaXB0aW9uPXZhdWx0CkRvY3VtZW50YXRpb249aHR0cDovL2xvY2FsaG9zdApbU2VydmljZV0KQW1iaWVudENhcGFiaWxpdGllcz1DQVBfSVBDX0xPQ0sKQ2FwYWJpbGl0aWVzPUNBUF9JUENfTE9DSytlcApDYXBhYmlsaXR5Qm91bmRpbmdTZXQ9Q0FQX1NZU0xPRyBDQVBfSVBDX0xPQ0sKRXhlY1JlbG9hZD0vYmluL2tpbGwgLS1zaWduYWwgSFVQICRNQUlOUElECkV4ZWNTdGFydD0vdXNyL2xvY2FsL2Jpbi92YXVsdCBzZXJ2ZXIgLWNvbmZpZz0vZXRjL3ZhdWx0LmQvdmF1bHQuaGNsCkV4ZWNTdGFydFBvc3Q9L2V0Yy92YXVsdC5kL3NjcmlwdHMvcG9zdF9zdGFydC5zaApHcm91cD12YXVsdApLaWxsTW9kZT1wcm9jZXNzCktpbGxTaWduYWw9U0lHSU5UCkxpbWl0TUVNTE9DSz1pbmZpbml0eQpMaW1pdE5PRklMRT02NTUzNgpOb05ld1ByaXZpbGVnZXM9eWVzClByaXZhdGVEZXZpY2VzPXllcwpQcml2YXRlVG1wPXllcwpQcm90ZWN0SG9tZT1yZWFkLW9ubHkKUHJvdGVjdFN5c3RlbT1mdWxsClJlc3RhcnQ9b24tZmFpbHVyZQpSZXN0YXJ0U2VjPTUKU2VjdXJlQml0cz1rZWVwLWNhcHMKVGltZW91dFN0b3BTZWM9MzAKVXNlcj12YXVsdApbSW5zdGFsbF0KV2FudGVkQnk9bXVsdGktdXNlci50YXJnZXQ=\nFILE_CONTENT\nchown root:root /etc/systemd/system/vault.service\nchmod 0644 /etc/systemd/system/vault.service\nsystemctl start vault\nsystemctl enable vault\napt-get install -y apt-transport-https ca-certificates curl gnupg-agent software-properties-common\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -\nsudo add-apt-repository  \"deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\" \napt-get update\napt-get install -y docker-ce docker-ce-cli containerd.io\nmkdir -p /etc/nomad.d\nchown root:root /etc/nomad.d\nchmod 700 /etc/nomad.d\nmkdir -p /opt/nomad\nchown root:root /opt/nomad\nchmod 0755 /opt/nomad\ncurl -L https://releases.hashicorp.com/nomad/0.10.4/nomad_0.10.4_linux_amd64.zip -o /tmp/nomad-0.10.4.zip\nchown root:root /tmp/nomad-0.10.4.zip\nchmod 0644 /tmp/nomad-0.10.4.zip\nunzip -x /tmp/nomad-0.10.4.zip -d /usr/local/bin\nrm /tmp/nomad-0.10.4.zip\nnomad -autocomplete-install\ncomplete -C /usr/local/bin/nomad nomad\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/nomad.d/nomad.hcl\nZGF0YV9kaXIgPSAiL29wdC9ub21hZCI=\nFILE_CONTENT\nchown root:root /etc/nomad.d/nomad.hcl\nchmod 0644 /etc/nomad.d/nomad.hcl\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/nomad.d/datacenter.hcl\nZGF0YWNlbnRlciA9ICJhbXMzYzAxIg==\nFILE_CONTENT\nchown root:root /etc/nomad.d/datacenter.hcl\nchmod 0644 /etc/nomad.d/datacenter.hcl\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/nomad.d/client.hcl\nY2xpZW50IHsKICBlbmFibGVkID0gdHJ1ZQp9Cg==\nFILE_CONTENT\nchown root:root /etc/nomad.d/client.hcl\nchmod 0644 /etc/nomad.d/client.hcl\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/nomad.d/server.hcl\nc2VydmVyIHsKICBlbmFibGVkID0gdHJ1ZQogIGJvb3RzdHJhcF9leHBlY3QgPSAzCn0K\nFILE_CONTENT\nchown root:root /etc/nomad.d/server.hcl\nchmod 0644 /etc/nomad.d/server.hcl\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/nomad.d/99-additional-configs.hcl\nYWR2ZXJ0aXNlIHsKICAgIGh0dHAgPSAie3tHZXRQdWJsaWNJUH19IgogICAgcnBjID0gInt7R2V0UHVibGljSVB9fSIKICAgIHNlcmYgPSAie3tHZXRQdWJsaWNJUH19Igp9Cg==\nFILE_CONTENT\nchown root:root /etc/nomad.d/99-additional-configs.hcl\nchmod 0644 /etc/nomad.d/99-additional-configs.hcl\ncat \u003c\u003cFILE_CONTENT | base64 -d | tee /etc/systemd/system/nomad.service\nW1VuaXRdCkRlc2NyaXB0aW9uPW5vbWFkCkRvY3VtZW50YXRpb249aHR0cDovL2xvY2FsaG9zdApbU2VydmljZV0KRXhlY1JlbG9hZD0vYmluL2tpbGwgLUhVUCAkTUFJTlBJRApFeGVjU3RhcnQ9L3Vzci9sb2NhbC9iaW4vbm9tYWQgYWdlbnQgLWNvbmZpZyAvZXRjL25vbWFkLmQKS2lsbE1vZGU9cHJvY2VzcwpLaWxsU2lnbmFsPVNJR0lOVApMaW1pdE5PRklMRT1pbmZpbml0eQpMaW1pdE5QUk9DPWluZmluaXR5ClJlc3RhcnQ9b24tZmFpbHVyZQpSZXN0YXJ0U2VjPTIKU3RhcnRMaW1pdEJ1cnN0PTMKU3RhcnRMaW1pdEludGVydmFsU2VjPTEwClRhc2tzTWF4PWluZmluaXR5CltJbnN0YWxsXQpXYW50ZWRCeT1tdWx0aS11c2VyLnRhcmdldA==\nFILE_CONTENT\nchown root:root /etc/systemd/system/nomad.service\nchmod 0644 /etc/systemd/system/nomad.service\nsystemctl start nomad\nsystemctl enable nomad",
          "lifecycle": {
            "create_before_destroy": true,
            "ignore_changes": [
              "user_data"
            ]
          }
        }
      },
      "digitalocean_ssh_key": {
        "smintz-0": {
          "name": "smintz-0",
          "public_key": "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCk4ST4XhbBmZ3AKej/HWBBvodS/GBs3T6w6pP3WS2463QSOPnY42SVeH4AJZP3nVvvljeH7cYdFShastYOA6pkCxIVw7HSkE2xPLc+09n8bzaU3L8kHmjtfyZEQRxKmYTJA9dv0o3QYiJZgPWvUfGoLSYG4fqgD7KBZZrO+kygoAVby23mK3uPY67Z3mwQ8tB2JL3Fj00zbe+dTagHzXbudlUk28DvWBN59F8xLRZ0zI263MkkS0/1DuzmLlwj9XDfKaSxfSBOLBlAVF3CJ63dHLZ72JQ3ca5utFHkyK+WWymZskN+g3ahlvzb/cN/mMbSusVjvYg7+SDvPiN0waFP smintz@onavo"
        }
      },
      "random_pet": {
        "server-3-ams3-c01": {},
        "server-4-ams3-c01": {},
        "server-5-ams3-c01": {}
      },
      "tls_cert_request": {
        "server-3-ams3-c01-consul": {
          "dns_names": [
            "${random_pet.server-3-ams3-c01.id}",
            "${random_pet.server-3-ams3-c01.id}.node.ams3c01.pco.nf",
            "consul.service.pco.nf",
            "consul.service.ams3c01.pco.nf",
            "localhost"
          ],
          "ip_addresses": [
            "127.0.0.1"
          ],
          "key_algorithm": "${tls_private_key.server-3-ams3-c01-consul.algorithm}",
          "private_key_pem": "${tls_private_key.server-3-ams3-c01-consul.private_key_pem}",
          "subject": {
            "common_name": "${random_pet.server-3-ams3-c01.id}.node.ams3c01.pco.nf"
          }
        },
        "server-3-ams3-c01-vault": {
          "dns_names": [
            "${random_pet.server-3-ams3-c01.id}",
            "${random_pet.server-3-ams3-c01.id}.node.ams3c01.pco.nf",
            "vault.service.pco.nf",
            "vault.service.ams3c01.pco.nf",
            "localhost"
          ],
          "ip_addresses": [
            "127.0.0.1"
          ],
          "key_algorithm": "${tls_private_key.server-3-ams3-c01-vault.algorithm}",
          "private_key_pem": "${tls_private_key.server-3-ams3-c01-vault.private_key_pem}",
          "subject": {
            "common_name": "${random_pet.server-3-ams3-c01.id}.node.ams3c01.pco.nf"
          }
        },
        "server-4-ams3-c01-consul": {
          "dns_names": [
            "${random_pet.server-4-ams3-c01.id}",
            "${random_pet.server-4-ams3-c01.id}.node.ams3c01.pco.nf",
            "consul.service.pco.nf",
            "consul.service.ams3c01.pco.nf",
            "localhost"
          ],
          "ip_addresses": [
            "127.0.0.1"
          ],
          "key_algorithm": "${tls_private_key.server-4-ams3-c01-consul.algorithm}",
          "private_key_pem": "${tls_private_key.server-4-ams3-c01-consul.private_key_pem}",
          "subject": {
            "common_name": "${random_pet.server-4-ams3-c01.id}.node.ams3c01.pco.nf"
          }
        },
        "server-4-ams3-c01-vault": {
          "dns_names": [
            "${random_pet.server-4-ams3-c01.id}",
            "${random_pet.server-4-ams3-c01.id}.node.ams3c01.pco.nf",
            "vault.service.pco.nf",
            "vault.service.ams3c01.pco.nf",
            "localhost"
          ],
          "ip_addresses": [
            "127.0.0.1"
          ],
          "key_algorithm": "${tls_private_key.server-4-ams3-c01-vault.algorithm}",
          "private_key_pem": "${tls_private_key.server-4-ams3-c01-vault.private_key_pem}",
          "subject": {
            "common_name": "${random_pet.server-4-ams3-c01.id}.node.ams3c01.pco.nf"
          }
        },
        "server-5-ams3-c01-consul": {
          "dns_names": [
            "${random_pet.server-5-ams3-c01.id}",
            "${random_pet.server-5-ams3-c01.id}.node.ams3c01.pco.nf",
            "consul.service.pco.nf",
            "consul.service.ams3c01.pco.nf",
            "localhost"
          ],
          "ip_addresses": [
            "127.0.0.1"
          ],
          "key_algorithm": "${tls_private_key.server-5-ams3-c01-consul.algorithm}",
          "private_key_pem": "${tls_private_key.server-5-ams3-c01-consul.private_key_pem}",
          "subject": {
            "common_name": "${random_pet.server-5-ams3-c01.id}.node.ams3c01.pco.nf"
          }
        },
        "server-5-ams3-c01-vault": {
          "dns_names": [
            "${random_pet.server-5-ams3-c01.id}",
            "${random_pet.server-5-ams3-c01.id}.node.ams3c01.pco.nf",
            "vault.service.pco.nf",
            "vault.service.ams3c01.pco.nf",
            "localhost"
          ],
          "ip_addresses": [
            "127.0.0.1"
          ],
          "key_algorithm": "${tls_private_key.server-5-ams3-c01-vault.algorithm}",
          "private_key_pem": "${tls_private_key.server-5-ams3-c01-vault.private_key_pem}",
          "subject": {
            "common_name": "${random_pet.server-5-ams3-c01.id}.node.ams3c01.pco.nf"
          }
        }
      },
      "tls_locally_signed_cert": {
        "server-3-ams3-c01-consul": {
          "allowed_uses": [
            "key_encipherment",
            "digital_signature",
            "server_auth"
          ],
          "ca_cert_pem": "${tls_self_signed_cert.root.cert_pem}",
          "ca_key_algorithm": "${tls_private_key.root.algorithm}",
          "ca_private_key_pem": "${tls_private_key.root.private_key_pem}",
          "cert_request_pem": "${tls_cert_request.server-3-ams3-c01-consul.cert_request_pem}",
          "early_renewal_hours": 720,
          "validity_period_hours": 2160
        },
        "server-3-ams3-c01-vault": {
          "allowed_uses": [
            "key_encipherment",
            "digital_signature",
            "server_auth"
          ],
          "ca_cert_pem": "${tls_self_signed_cert.root.cert_pem}",
          "ca_key_algorithm": "${tls_private_key.root.algorithm}",
          "ca_private_key_pem": "${tls_private_key.root.private_key_pem}",
          "cert_request_pem": "${tls_cert_request.server-3-ams3-c01-vault.cert_request_pem}",
          "early_renewal_hours": 720,
          "validity_period_hours": 2160
        },
        "server-4-ams3-c01-consul": {
          "allowed_uses": [
            "key_encipherment",
            "digital_signature",
            "server_auth"
          ],
          "ca_cert_pem": "${tls_self_signed_cert.root.cert_pem}",
          "ca_key_algorithm": "${tls_private_key.root.algorithm}",
          "ca_private_key_pem": "${tls_private_key.root.private_key_pem}",
          "cert_request_pem": "${tls_cert_request.server-4-ams3-c01-consul.cert_request_pem}",
          "early_renewal_hours": 720,
          "validity_period_hours": 2160
        },
        "server-4-ams3-c01-vault": {
          "allowed_uses": [
            "key_encipherment",
            "digital_signature",
            "server_auth"
          ],
          "ca_cert_pem": "${tls_self_signed_cert.root.cert_pem}",
          "ca_key_algorithm": "${tls_private_key.root.algorithm}",
          "ca_private_key_pem": "${tls_private_key.root.private_key_pem}",
          "cert_request_pem": "${tls_cert_request.server-4-ams3-c01-vault.cert_request_pem}",
          "early_renewal_hours": 720,
          "validity_period_hours": 2160
        },
        "server-5-ams3-c01-consul": {
          "allowed_uses": [
            "key_encipherment",
            "digital_signature",
            "server_auth"
          ],
          "ca_cert_pem": "${tls_self_signed_cert.root.cert_pem}",
          "ca_key_algorithm": "${tls_private_key.root.algorithm}",
          "ca_private_key_pem": "${tls_private_key.root.private_key_pem}",
          "cert_request_pem": "${tls_cert_request.server-5-ams3-c01-consul.cert_request_pem}",
          "early_renewal_hours": 720,
          "validity_period_hours": 2160
        },
        "server-5-ams3-c01-vault": {
          "allowed_uses": [
            "key_encipherment",
            "digital_signature",
            "server_auth"
          ],
          "ca_cert_pem": "${tls_self_signed_cert.root.cert_pem}",
          "ca_key_algorithm": "${tls_private_key.root.algorithm}",
          "ca_private_key_pem": "${tls_private_key.root.private_key_pem}",
          "cert_request_pem": "${tls_cert_request.server-5-ams3-c01-vault.cert_request_pem}",
          "early_renewal_hours": 720,
          "validity_period_hours": 2160
        }
      },
      "tls_private_key": {
        "root": {
          "algorithm": "ECDSA",
          "ecdsa_curve": "P384"
        },
        "server-3-ams3-c01-consul": {
          "algorithm": "ECDSA",
          "ecdsa_curve": "P384"
        },
        "server-3-ams3-c01-vault": {
          "algorithm": "ECDSA",
          "ecdsa_curve": "P384"
        },
        "server-4-ams3-c01-consul": {
          "algorithm": "ECDSA",
          "ecdsa_curve": "P384"
        },
        "server-4-ams3-c01-vault": {
          "algorithm": "ECDSA",
          "ecdsa_curve": "P384"
        },
        "server-5-ams3-c01-consul": {
          "algorithm": "ECDSA",
          "ecdsa_curve": "P384"
        },
        "server-5-ams3-c01-vault": {
          "algorithm": "ECDSA",
          "ecdsa_curve": "P384"
        }
      },
      "tls_self_signed_cert": {
        "root": {
          "allowed_uses": [
            "cert_signing",
            "key_encipherment",
            "digital_signature",
            "server_auth",
            "client_auth"
          ],
          "dns_names": [
            "protoconf.com"
          ],
          "early_renewal_hours": 43800,
          "is_ca_certificate": true,
          "key_algorithm": "${tls_private_key.root.algorithm}",
          "private_key_pem": "${tls_private_key.root.private_key_pem}",
          "validity_period_hours": 87600,
          "subject": {
            "organization": "protoconf",
            "common_name": "protoconf.com",
            "organizational_unit": "protocorp"
          }
        }
      }
    }
  }
}
